package main

import (
	"context"
	"fmt"
	"github.com/ethereum/go-ethereum"
	"github.com/ethereum/go-ethereum/accounts/abi"
	"github.com/ethereum/go-ethereum/accounts/abi/bind/backends"
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/common/hexutil"
	"github.com/ethereum/go-ethereum/core"
	"github.com/ethereum/go-ethereum/core/vm"
	"math/big"
	"strings"
	"time"
)

func newArguments(typeNames ...string) abi.Arguments {
	var args abi.Arguments
	for i, tn := range typeNames {
		abiType, err := abi.NewType(tn, tn, nil)
		if err != nil {
			panic(err)
		}
		args = append(args, abi.Argument{Name: fmt.Sprintf("%d", i), Type: abiType})
	}
	return args
}

func mustNewArguments(types ...string) (result abi.Arguments) {
	var err error
	for _, t := range types {
		var typ abi.Type
		items := strings.Split(t, " ")
		var name string
		if len(items) == 2 {
			name = items[1]
		} else {
			name = items[0]
		}
		typ, err = abi.NewType(items[0], items[0], nil)
		if err != nil {
			panic(err)
		}
		result = append(result, abi.Argument{Type: typ, Name: name})
	}
	return result
}

var verifyParliaBlockInput = mustNewArguments(
	"uint256 chainId",
	"bytes blockProof",
	"uint32 epochInterval",
)

var measureBlockInput = mustNewArguments(
	"bytes blockProof",
	"uint256 chainId",
)

func createBytecode() []byte {
	backend := backends.NewSimulatedBackend(core.GenesisAlloc{}, 8_000_000)
	bytecode, err := backend.CallContract(context.Background(), ethereum.CallMsg{
		Data: hexutil.MustDecode("0x60c060405234801561001057600080fd5b50600f60805260c860a05260805160a0516125af6100476000396000818161049d0152610e510152600061047c01526125af6000f3fe608060405234801561001057600080fd5b50600436106100625760003560e01c80632a36f0ad146100675780632b150b3c146100975780632dae36a0146100b7578063783d0962146100d757806386cd0354146100ea578063e4adf32f1461010a575b600080fd5b61007a610075366004611f69565b61012b565b6040516001600160401b0390911681526020015b60405180910390f35b6100aa6100a5366004611fb4565b61014f565b60405161008e9190611ff5565b6100ca6100c53660046120da565b610387565b60405161008e919061216e565b6100ca6100e5366004611f69565b6103f6565b6100fd6100f8366004611f69565b610462565b60405161008e91906121ce565b61011d6101183660046122cf565b610475565b60405161008e929190612348565b60005a905061013b8484846108f3565b505a6101479082612389565b949350505050565b604080516101a081018252600080825260208201819052918101829052606081018290526080810182905260a0810182905260c0810182905260e0810182905261010081018290526101208101829052610140810182905261016081018290526101808101829052906101c28484610f9d565b90506101cd81610fb3565b82526101d881610fc6565b90506101e381610fb3565b60208301526101f181610fc6565b90506101fc81610fdb565b6001600160a01b0316604083015261021381610fc6565b905061021e81610fb3565b606083015261022c81610fc6565b905061023781610fb3565b608083015261024581610fc6565b905061025081610fb3565b60a083015261025e81610fc6565b905061026981610fc6565b905061027481610fc6565b90506102888161028383610fe8565b61108b565b6001600160401b031660c083015261029f81610fc6565b90506102ae8161028383610fe8565b6001600160401b031660e08301526102c581610fc6565b90506102d48161028383610fe8565b6001600160401b03166101008301526102ec81610fc6565b90506102fb8161028383610fe8565b6001600160401b031661012083015261031381610fc6565b905061031e81610fc6565b905061032981610fb3565b61014083015261033881610fc6565b90506103478161028383610fe8565b6001600160401b031661016083015261035f81610fc6565b905083836040516103719291906123b1565b6040519081900390206101808301525092915050565b606060006103968686866108f3565b9050828160200151146103e95760405162461bcd60e51b81526020600482015260166024820152756e6f74206120636865636b706f696e7420626c6f636b60501b60448201526064015b60405180910390fd5b6060015195945050505050565b606060006104058585856108f3565b80519091506001600160401b0316156104565760405162461bcd60e51b81526020600482015260136024820152726e6f7420612067656e6573697320626c6f636b60681b60448201526064016103e0565b60600151949350505050565b61046a611ee3565b6101478484846108f3565b60606000807f00000000000000000000000000000000000000000000000000000000000000007f000000000000000000000000000000000000000000000000000000000000000063ffffffff82168910156105105760405162461bcd60e51b815260206004820152601b60248201527a0dac2d6ca40e6eae4ca40e0e4dedecce640c2e4ca40cadcdeeaced602b1b60448201526064016103e0565b6000896001600160401b0381111561052a5761052a6123c1565b604051908082528060200260200182016040528015610553578160200160208202803683370190505b5090506000805b8463ffffffff1681101561088f5760006105978e8e8481811061057f5761057f6123d7565b905060200281019061059191906123ed565b8e6108f3565b60808101518051919250600160f81b9160409081106105b8576105b86123d7565b01602001516001600160f81b0319160361060457601c60f81b81608001516040815181106105e8576105e86123d7565b60200101906001600160f81b031916908160001a905350610638565b601b60f81b8160800151604081518110610620576106206123d7565b60200101906001600160f81b031916908160001a9053505b6000610653826040015180519060200120836080015161109e565b90506000805b8c8110156106bb57826001600160a01b03168e8e8381811061067d5761067d6123d7565b90506020020160208101906106929190612433565b6001600160a01b0316036106a957600191506106bb565b806106b38161245c565b915050610659565b50806106fa5760405162461bcd60e51b815260206004820152600e60248201526d3ab735b737bbb71039b4b3b732b960911b60448201526064016103e0565b6000805b866001600160401b031681101561075c57836001600160a01b031688828151811061072b5761072b6123d7565b60200260200101516001600160a01b03160361074a576001915061075c565b806107548161245c565b9150506106fe565b50806107a4578287876001600160401b03168151811061077e5761077e6123d7565b6001600160a01b0390921660209283029190910190910152856107a081612475565b9650505b8460000361082b5783516107bf9063ffffffff8a16906124b1565b6001600160401b0316156108035760405162461bcd60e51b815260206004820152600b60248201526a65706f636820626c6f636b60a81b60448201526064016103e0565b83516108169063ffffffff8a16906124d7565b9a5083606001519b5083602001519950610878565b898460a00151146108705760405162461bcd60e51b815260206004820152600f60248201526e0c4c2c840e0c2e4cadce840d0c2e6d608b1b60448201526064016103e0565b836020015199505b5050505080806108879061245c565b91505061055a565b508363ffffffff16816001600160401b031610156108e45760405162461bcd60e51b81526020600482015260126024820152711c5d5bdc9d5b481b9bdd081c995858da195960721b60448201526064016103e0565b50505050509550959350505050565b6108fb611ee3565b61ffff83111561090a57600080fd5b83600061091682610fe8565b9050610921826110c2565b915061092c82610fb3565b60a084015261093d6101bd836124fd565b915061094882610fc6565b91506109578261028384610fe8565b6001600160401b03168352610975610970808085610fc6565b610fc6565b91508161098181610fc6565b925082600061098f836110cd565b90506000806041836109a18787612515565b6109ab9190612515565b6109b59190612515565b905060388110156109c957600191506109e0565b6109d2816110d8565b6109dd9060016124fd565b91505b5060006109ec8961116b565b9050600060418385898551610a0191906124fd565b610a0b9190612515565b610a1591906124fd565b610a1f9190612515565b6001600160401b03811115610a3657610a366123c1565b6040519080825280601f01601f191660200182016040528015610a60576020820181803683370190505b50905060f960f81b81600081518110610a7b57610a7b6123d7565b60200101906001600160f81b031916908160001a905350600060038251610aa29190612515565b9050600881901c60f81b82600181518110610abf57610abf6123d7565b60200101906001600160f81b031916908160001a905350600081901c60f81b82600281518110610af157610af16123d7565b60200101906001600160f81b031916908160001a9053505060005b8251811015610b7b57828181518110610b2757610b276123d7565b01602001516001600160f81b03191682610b428360036124fd565b81518110610b5257610b526123d7565b60200101906001600160f81b031916908160001a90535080610b738161245c565b915050610b0c565b506023825101810160038d01808803808284379190910184019050868501604019888803879003018082843791909101905085602a8082843750505060008060418689890303039150602a85830101835103905084600403610cd057605d60f91b83610be88360006124fd565b81518110610bf857610bf86123d7565b60200101906001600160f81b031916908160001a9053506001600160f81b031960e883901b1683610c2a8360016124fd565b81518110610c3a57610c3a6123d7565b60200101906001600160f81b031916908160001a9053506001600160f81b031960f083901b1683610c6c8360026124fd565b81518110610c7c57610c7c6123d7565b60200101906001600160f81b031916908160001a90535060f882901b83610ca48360036124fd565b81518110610cb457610cb46123d7565b60200101906001600160f81b031916908160001a905350610e09565b84600303610d635760b960f81b83610ce98360006124fd565b81518110610cf957610cf96123d7565b60200101906001600160f81b031916908160001a9053506001600160f81b031960f083901b1683610d2b8360016124fd565b81518110610d3b57610d3b6123d7565b60200101906001600160f81b031916908160001a90535060f882901b83610ca48360026124fd565b84600203610dbe57601760fb1b83610d7c8360006124fd565b81518110610d8c57610d8c6123d7565b60200101906001600160f81b031916908160001a9053506001600160f81b031960f083901b1683610ca48360016124fd565b6038821015610e0957610dd28260806124fd565b60f81b83610de18360006124fd565b81518110610df157610df16123d7565b60200101906001600160f81b031916908160001a9053505b5050604089810182905280516041808252608082019092526000916020820181803683370190505090506041808703602083013760808a018190528951610e779063ffffffff7f000000000000000000000000000000000000000000000000000000000000000016906124b1565b6001600160401b0316600003610f6f57600060146020604188610e9a8c8c612515565b610ea491906124fd565b610eae9190612515565b610eb89190612515565b610ec2919061252c565b90506000816001600160401b03811115610ede57610ede6123c1565b604051908082528060200260200182016040528015610f07578160200160208202803683370190505b50905060005b82811015610f675760006020601483028a8d010101359050606081901c838381518110610f3c57610f3c6123d7565b6001600160a01b03909216602092830291909101909101525080610f5f8161245c565b915050610f0d565b5060608c0152505b8c8c604051610f7f9291906123b1565b60405190819003902060208b01525050505050505050509392505050565b600082610fa981611af7565b61014790826124fd565b6000610fc0826021611b71565b92915050565b6000610fd182610fe8565b610fc090836124fd565b6000610fc0826015611b71565b6000808235811a60808110156110015760019150611084565b60b881101561102757611015608082612515565b6110209060016124fd565b9150611084565b60c0811015611052576001939093019283356008602083900360b701021c810160b519019150611084565b60f88110156110665761101560c082612515565b6001939093019283356008602083900360f701021c810160f5190191505b5092915050565b60006110978383611b71565b9392505050565b60008060006110ad8585611baf565b915091506110ba81611c1d565b509392505050565b6000610fd182611af7565b6000610fc082611af7565b60006101008210156110ec57506001919050565b620100008210156110ff57506002919050565b630100000082101561111357506003919050565b600160201b82101561112757506004919050565b600160281b82101561113b57506005919050565b600160301b82101561114f57506006919050565b600160381b82101561116357506007919050565b506008919050565b6060816000036111c85760408051600180825281830190925290602082018180368337019050509050608060f81b816000815181106111ac576111ac6123d7565b60200101906001600160f81b031916908160001a905350919050565b607f821161120657604080516001808252818301909252906020820181803683370190505090508160f81b816000815181106111ac576111ac6123d7565b6101008210156112755760408051600280825281830190925290602082018180368337019050509050608160f81b81600081518110611247576112476123d7565b60200101906001600160f81b031916908160001a9053508160f81b816001815181106111ac576111ac6123d7565b620100008210156113175760408051600380825281830190925290602082018180368337019050509050608260f81b816000815181106112b7576112b76123d7565b60200101906001600160f81b031916908160001a905350600882901c60f81b816001815181106112e9576112e96123d7565b60200101906001600160f81b031916908160001a9053508160f81b816002815181106111ac576111ac6123d7565b63010000008210156113ec5760408051600480825281830190925290602082018180368337019050509050608360f81b8160008151811061135a5761135a6123d7565b60200101906001600160f81b031916908160001a905350601082901c60f81b8160018151811061138c5761138c6123d7565b60200101906001600160f81b031916908160001a905350600882901c60f81b816002815181106113be576113be6123d7565b60200101906001600160f81b031916908160001a9053508160f81b816003815181106111ac576111ac6123d7565b600160201b8210156114f35760408051600580825281830190925290602082018180368337019050509050608460f81b8160008151811061142f5761142f6123d7565b60200101906001600160f81b031916908160001a905350601882901c60f81b81600181518110611461576114616123d7565b60200101906001600160f81b031916908160001a905350601082901c60f81b81600281518110611493576114936123d7565b60200101906001600160f81b031916908160001a905350600882901c60f81b816003815181106114c5576114c56123d7565b60200101906001600160f81b031916908160001a9053508160f81b816004815181106111ac576111ac6123d7565b600160281b82101561162c5760408051600680825281830190925290602082018180368337019050509050608560f81b81600081518110611536576115366123d7565b60200101906001600160f81b031916908160001a905350602082901c60f81b81600181518110611568576115686123d7565b60200101906001600160f81b031916908160001a905350601882901c60f81b8160028151811061159a5761159a6123d7565b60200101906001600160f81b031916908160001a905350601082901c60f81b816003815181106115cc576115cc6123d7565b60200101906001600160f81b031916908160001a905350600882901c60f81b816004815181106115fe576115fe6123d7565b60200101906001600160f81b031916908160001a9053508160f81b816005815181106111ac576111ac6123d7565b600160301b8210156117975760408051600780825281830190925290602082018180368337019050509050608660f81b8160008151811061166f5761166f6123d7565b60200101906001600160f81b031916908160001a905350602882901c60f81b816001815181106116a1576116a16123d7565b60200101906001600160f81b031916908160001a905350602082901c60f81b816002815181106116d3576116d36123d7565b60200101906001600160f81b031916908160001a905350601882901c60f81b81600381518110611705576117056123d7565b60200101906001600160f81b031916908160001a905350601082901c60f81b81600481518110611737576117376123d7565b60200101906001600160f81b031916908160001a905350600882901c60f81b81600581518110611769576117696123d7565b60200101906001600160f81b031916908160001a9053508160f81b816006815181106111ac576111ac6123d7565b600160381b8210156119345760408051600880825281830190925290602082018180368337019050509050608760f81b816000815181106117da576117da6123d7565b60200101906001600160f81b031916908160001a905350603082901c60f81b8160018151811061180c5761180c6123d7565b60200101906001600160f81b031916908160001a905350602882901c60f81b8160028151811061183e5761183e6123d7565b60200101906001600160f81b031916908160001a905350602082901c60f81b81600381518110611870576118706123d7565b60200101906001600160f81b031916908160001a905350601882901c60f81b816004815181106118a2576118a26123d7565b60200101906001600160f81b031916908160001a905350601082901c60f81b816005815181106118d4576118d46123d7565b60200101906001600160f81b031916908160001a905350600882901c60f81b81600681518110611906576119066123d7565b60200101906001600160f81b031916908160001a9053508160f81b816007815181106111ac576111ac6123d7565b60408051600980825281830190925290602082018180368337019050509050608860f81b8160008151811061196b5761196b6123d7565b60200101906001600160f81b031916908160001a905350603882901c60f81b8160018151811061199d5761199d6123d7565b60200101906001600160f81b031916908160001a905350603082901c60f81b816002815181106119cf576119cf6123d7565b60200101906001600160f81b031916908160001a905350602882901c60f81b81600381518110611a0157611a016123d7565b60200101906001600160f81b031916908160001a905350602082901c60f81b81600481518110611a3357611a336123d7565b60200101906001600160f81b031916908160001a905350601882901c60f81b81600581518110611a6557611a656123d7565b60200101906001600160f81b031916908160001a905350601082901c60f81b81600681518110611a9757611a976123d7565b60200101906001600160f81b031916908160001a905350600882901c60f81b81600781518110611ac957611ac96123d7565b60200101906001600160f81b031916908160001a9053508160f81b816008815181106111ac576111ac6123d7565b60008135811a6080811015611b0f5750600092915050565b60b8811080611b2a575060c08110801590611b2a575060f881105b15611b385750600192915050565b60c0811015611b6557611b4d600160b8612540565b611b5a9060ff1682612515565b6110979060016124fd565b611b4d600160f8612540565b60008082118015611b83575060218211155b611b8c57600080fd5b6000611b9784611af7565b93840135939092036020036008029290921c92915050565b6000808251604103611be55760208301516040840151606085015160001a611bd987828585611dd1565b94509450505050611c16565b8251604003611c0e5760208301516040840151611c03868383611eb4565b935093505050611c16565b506000905060025b9250929050565b6000816004811115611c3157611c31612563565b03611c395750565b6001816004811115611c4d57611c4d612563565b03611c955760405162461bcd60e51b815260206004820152601860248201527745434453413a20696e76616c6964207369676e617475726560401b60448201526064016103e0565b6002816004811115611ca957611ca9612563565b03611cf65760405162461bcd60e51b815260206004820152601f60248201527f45434453413a20696e76616c6964207369676e6174757265206c656e6774680060448201526064016103e0565b6003816004811115611d0a57611d0a612563565b03611d625760405162461bcd60e51b815260206004820152602260248201527f45434453413a20696e76616c6964207369676e6174757265202773272076616c604482015261756560f01b60648201526084016103e0565b6004816004811115611d7657611d76612563565b03611dce5760405162461bcd60e51b815260206004820152602260248201527f45434453413a20696e76616c6964207369676e6174757265202776272076616c604482015261756560f01b60648201526084016103e0565b50565b6000806fa2a8918ca85bafe22016d0b997e4df60600160ff1b03831115611dfe5750600090506003611eab565b8460ff16601b14158015611e1657508460ff16601c14155b15611e275750600090506004611eab565b6040805160008082526020820180845289905260ff881692820192909252606081018690526080810185905260019060a0016020604051602081039080840390855afa158015611e7b573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b038116611ea457600060019250925050611eab565b9150600090505b94509492505050565b6000806001600160ff1b03831660ff84901c601b01611ed587828885611dd1565b935093505050935093915050565b6040518060c0016040528060006001600160401b0316815260200160008019168152602001606081526020016060815260200160608152602001600080191681525090565b60008083601f840112611f3a57600080fd5b5081356001600160401b03811115611f5157600080fd5b602083019150836020828501011115611c1657600080fd5b600080600060408486031215611f7e57600080fd5b83356001600160401b03811115611f9457600080fd5b611fa086828701611f28565b909790965060209590950135949350505050565b60008060208385031215611fc757600080fd5b82356001600160401b03811115611fdd57600080fd5b611fe985828601611f28565b90969095509350505050565b60006101a0820190508251825260208301516020830152604083015161202660408401826001600160a01b03169052565b50606083015160608301526080830151608083015260a083015160a083015260c083015161205f60c08401826001600160401b03169052565b5060e083015161207a60e08401826001600160401b03169052565b50610100838101516001600160401b038116848301525050610120838101516001600160401b0381168483015250506101408381015190830152610160808401516001600160401b03811682850152505061018092830151919092015290565b600080600080606085870312156120f057600080fd5b84356001600160401b0381111561210657600080fd5b61211287828801611f28565b90989097506020870135966040013595509350505050565b600081518084526020808501945080840160005b838110156121635781516001600160a01b03168752958201959082019060010161213e565b509495945050505050565b602081526000611097602083018461212a565b6000815180845260005b818110156121a75760208185018101518683018201520161218b565b818111156121b9576000602083870101525b50601f01601f19169290920160200192915050565b600060208083526001600160401b0384511681840152808401516040840152604084015160c0606085015261220660e0850182612181565b6060860151601f1986830381016080880152815180845291850193506000929091908501905b808410156122555784516001600160a01b0316825293850193600193909301929085019061222c565b5060808801519450818782030160a08801526122718186612181565b94505050505060a084015160c08401528091505092915050565b60008083601f84011261229d57600080fd5b5081356001600160401b038111156122b457600080fd5b6020830191508360208260051b8501011115611c1657600080fd5b6000806000806000606086880312156122e757600080fd5b85356001600160401b03808211156122fe57600080fd5b61230a89838a0161228b565b909750955060208801359450604088013591508082111561232a57600080fd5b506123378882890161228b565b969995985093965092949392505050565b60408152600061235b604083018561212a565b90506001600160401b03831660208301529392505050565b634e487b7160e01b600052601160045260246000fd5b60006001600160401b03838116908316818110156123a9576123a9612373565b039392505050565b8183823760009101908152919050565b634e487b7160e01b600052604160045260246000fd5b634e487b7160e01b600052603260045260246000fd5b6000808335601e1984360301811261240457600080fd5b8301803591506001600160401b0382111561241e57600080fd5b602001915036819003821315611c1657600080fd5b60006020828403121561244557600080fd5b81356001600160a01b038116811461109757600080fd5b60006001820161246e5761246e612373565b5060010190565b60006001600160401b0380831681810361249157612491612373565b6001019392505050565b634e487b7160e01b600052601260045260246000fd5b60006001600160401b03808416806124cb576124cb61249b565b92169190910692915050565b60006001600160401b03808416806124f1576124f161249b565b92169190910492915050565b6000821982111561251057612510612373565b500190565b60008282101561252757612527612373565b500390565b60008261253b5761253b61249b565b500490565b600060ff821660ff84168082101561255a5761255a612373565b90039392505050565b634e487b7160e01b600052602160045260246000fdfea2646970667358221220807c30055346d79692c227c06915fd2145f9a2e85909164f32073615c886957564736f6c634300080e0033"),
	}, nil)
	if err != nil {
		panic(err)
	}
	return bytecode
}

var parliaBlockVerificationBytecode = createBytecode()

func main() {
	to := common.HexToAddress("0x0000000000000000000000000000000000000001")
	backend := backends.NewSimulatedBackend(core.GenesisAlloc{
		to: {
			Code:    parliaBlockVerificationBytecode,
			Balance: big.NewInt(0),
		},
	}, 8_000_000)
	blockProof := hexutil.MustDecode("0xf903fca00000000000000000000000000000000000000000000000000000000000000000a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794fffffffffffffffffffffffffffffffffffffffea0919fcc7ad870b53db0aa76eb588da06bacb6d230195100699fc928511003b422a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421b901000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001808402625a0080845e9da7ceb9020500000000000000000000000000000000000000000000000000000000000000002a7cdd959bfe8d9487b2a43b33565295a698f7e26488aa4d1955ee33403f8ccb1d4de5fb97c7ade29ef9f4360c606c7ab4db26b016007d3ad0ab86a0ee01c3b1283aa067c58eab4709f85e99d46de5fe685b1ded8013785d6623cc18d214320b6bb6475978f3adfc719c99674c072166708589033e2d9afec2be4ec20253b8642161bc3f444f53679c1f3d472f7be8361c80a4c1e7e9aaf001d0877f1cfde218ce2fd7544e0b2cc94692d4a704debef7bcb61328b8f7166496996a7da21cf1f1b04d9b3e26a3d0772d4c407bbe49438ed859fe965b140dcf1aab71a96bbad7cf34b5fa511d8e963dbba288b1960e75d64430b3230294d12c6ab2aac5c2cd68e80b16b581ea0a6e3c511bbd10f4519ece37dc24887e11b55d7ae2f5b9e386cd1b50a4550696d957cb4900f03a82012708dafc9e1b880fd083b32182b869be8e0922b81f8e175ffde54d797fe11eb03f9e3bf75f1d68bf0b8b6fb4e317a0f9d6f03eaf8ce6675bc60d8c4d90829ce8f72d0163c1d5cf348a862d55063035e7a025f4da968de7e4d7e4004197917f4070f1d6caa02bbebaebb5d7e581e4b66559e635f805ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000880000000000000000")
	const rounds = 100_000
	// solidity call
	input, err := measureBlockInput.Pack(blockProof, big.NewInt(65))
	if err != nil {
		panic(err)
	}
	solidityTime := time.Now().UnixNano()
	var gasUsed uint64
	for i := 0; i < rounds; i++ {
		gasUsed, err = backend.EstimateGas(context.Background(), ethereum.CallMsg{
			To:   &to,
			Data: append(hexutil.MustDecode("0x2a36f0ad"), input...),
		})
		if err != nil {
			panic(err)
		}
	}
	solidityTime = time.Now().UnixNano() - solidityTime
	fmt.Printf("elapsed time (solidity): %d ns\n", solidityTime)
	fmt.Printf("gas used (solidity): %d\n", gasUsed)
	// native call
	contract := vm.NewVerifyParliaBlock()
	input, err = verifyParliaBlockInput.Pack(big.NewInt(65), blockProof, uint32(200))
	if err != nil {
		panic(err)
	}
	nativeTime := time.Now().UnixNano()
	for i := 0; i < rounds; i++ {
		_, err = contract.Run(input)
		if err != nil {
			panic(err)
		}
	}
	nativeTime = time.Now().UnixNano() - nativeTime
	fmt.Printf("elapsed time (native): %d ns\n", nativeTime)
	fmt.Printf("optimal gas (native): ~%f\n", float64(gasUsed)*float64(nativeTime)/float64(solidityTime))
}
